
#FUNCTION HEADER# NAME :  AntiMalwareFunc 
# DESCRIPTION: Function for ROOTKIT HUNTER software
#anti virus with clamscan and lynis security audit
# INPUTS:  $1  CLAMAV or "RKHUNTER" or lynis
# PROCESS : clamav and rkhunter full scans
#NOTES :    needs clamav,lynis and rkhunter installed  

function AntiMalwareFunc
{
#clamav section
	if [ "$1" = "CLAMAV" ]
				then
            #check clamav is installed
            
            if ! msgFunc checkpac clamav
				then
				msgFunc anykey 
				return
			fi
			# update clamscan virus definitions:
			msgFunc green "Updating clamavscan Databases"
			sudo freshclam
			msgFunc green "Done!"
			msgFunc green "Scanning with Clamav$"
			# scan entire system
			msgFunc dir "-CLAMAVINFO"
			sudo clamscan -l clamavlogfile --recursive=yes --infected --exclude-dir='^/sys|^/proc|^/dev|^/lib|^/bin|^/sbin' /
			msgFunc green "Done!"			
			return
	fi
			
#Rootkitsection
	if [ "$1" = "RKHUNTER" ]
	then
		#check rkhunter is installed
		
		if ! msgFunc checkpac rkhunter
		then
			msgFunc anykey 
		return
		fi
		msgFunc green "Checking rkhunter data files"
		sudo rkhunter --update
		msgFunc green "Done!"
		msgFunc green "Fill the file properties database"
		sudo rkhunter --propupd
		msgFunc green "Done!"
		msgFunc green "Running Rootkit hunter"
		sudo rkhunter --check
		msgFunc green "Done!"
		msgFunc anykey
		return
	fi
	
#lynis section
	if [ "$1" = "LYNIS" ]
	then
		#check lynis is installed
		if ! msgFunc checkpac lynis
		then
			msgFunc anykey 
		return
		fi
		msgFunc green "Lynis - System and security auditing tool"
		 sudo  lynis audit system
		 msgFunc norm "Entire logfile at /var/log/lynis.log"
		 msgFunc norm  "Summary of logfile at:-"
		 msgFunc dir "-LYNISINFO"
		 {
		 echo "Warnings" 
		 sudo grep Warning /var/log/lynis.log 
		 echo "Suggestions" 
		 sudo grep Suggestion /var/log/lynis.log  
		 } >> lynisinfo
		msgFunc anykey
		msgFunc green "Done!"
	fi
	
}
